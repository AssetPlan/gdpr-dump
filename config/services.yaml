---
parameters:
    config.schema_file: '%app_root%/config/schema.json'
    faker.locale: 'en_US'

services:
    # --- Commands ---
    command.dump:
        class: 'Smile\GdprDump\Console\Command\DumpCommand'
        arguments:
            - '@dumper.sql'
            - '@config.storage'
            - '@config.loader'
            - '@config.validator'
        tags:
            - {name: 'console.command'}

    command.validate_config:
        class: 'Smile\GdprDump\Console\Command\ValidateConfigCommand'
        arguments:
            - '@config.validator'
            - '@config.parser'
            - '@config.resolver.path'
        tags:
            - {name: 'console.command'}

    # --- Configuration ---
    config.storage:
        class: 'Smile\GdprDump\Config\Config'

    config.loader:
        class: 'Smile\GdprDump\Config\ConfigLoader'
        arguments:
            - '@config.storage'
            - '@config.parser'
            - '@config.resolver.path'

    config.parser:
        class: 'Smile\GdprDump\Config\Parser\YamlParser'

    config.validator:
        class: 'Smile\GdprDump\Config\Validator\JsonSchemaValidator'
        arguments:
            - '%config.schema_file%'

    config.resolver.path:
        class: 'Smile\GdprDump\Config\Resolver\PathResolver'

    # --- Dumper ---
    dumper.sql:
        class: 'Smile\GdprDump\Dumper\SqlDumper'
        arguments:
            - '@converter.factory'

    # --- Converter ---
    converter.factory:
        class: 'Smile\GdprDump\Converter\ConverterFactory'
        arguments:
            - '@faker.service'

    # --- Faker ---
    faker.service:
        class: 'Smile\GdprDump\Faker\FakerService'
        arguments:
            - {locale: '%faker.locale%'}
